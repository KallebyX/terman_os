{% extends 'base.html' %}

{% block title %}Super Admin Dashboard | Terman OS{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="admin-page-header">
        <div>
            <h1 class="h2">
                <i class="bi bi-shield-lock-fill text-danger"></i>
                Super Admin Dashboard
            </h1>
            <p>Controle total do sistema - Bem-vindo, {{ current_user.nome }}</p>
        </div>
        <div class="admin-header-actions">
            <a href="{{ url_for('super_admin.novo_usuario') }}" class="btn btn-danger">
                <i class="bi bi-person-plus-fill me-2"></i>
                Novo Usuário
            </a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="admin-stats-grid">
        <div class="admin-stat-card primary">
            <div class="admin-stat-header">
                <div class="admin-stat-icon">
                    <i class="bi bi-people-fill"></i>
                </div>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-value">{{ total_usuarios }}</div>
                <div class="admin-stat-label">Total Usuários</div>
            </div>
            <div class="admin-stat-footer">
                <span class="positive">
                    <i class="bi bi-check-circle me-1"></i>{{ usuarios_ativos }} ativos
                </span>
                <span class="text-muted ms-2">{{ usuarios_inativos }} inativos</span>
            </div>
        </div>

        <div class="admin-stat-card danger">
            <div class="admin-stat-header">
                <div class="admin-stat-icon">
                    <i class="bi bi-shield-lock-fill"></i>
                </div>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-value">{{ total_super_admins }}</div>
                <div class="admin-stat-label">Super Admins</div>
            </div>
            <div class="admin-stat-footer">
                <span class="text-muted">Acesso total ao sistema</span>
            </div>
        </div>

        <div class="admin-stat-card warning">
            <div class="admin-stat-header">
                <div class="admin-stat-icon">
                    <i class="bi bi-person-badge-fill"></i>
                </div>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-value">{{ total_admins }}</div>
                <div class="admin-stat-label">Administradores</div>
            </div>
            <div class="admin-stat-footer">
                <span class="text-muted">Gerenciam produtos e pedidos</span>
            </div>
        </div>

        <div class="admin-stat-card success">
            <div class="admin-stat-header">
                <div class="admin-stat-icon">
                    <i class="bi bi-person-fill"></i>
                </div>
            </div>
            <div class="admin-stat-content">
                <div class="admin-stat-value">{{ total_clientes }}</div>
                <div class="admin-stat-label">Clientes</div>
            </div>
            <div class="admin-stat-footer">
                <span class="text-muted">Usuários da loja</span>
            </div>
        </div>
    </div>

    <!-- Quick Access -->
    <h4 class="mb-4 d-flex align-items-center gap-2">
        <i class="bi bi-lightning-fill text-warning"></i>
        Acesso Rápido
    </h4>

    <div class="admin-quick-grid mb-5">
        <a href="{{ url_for('super_admin.listar_usuarios') }}" class="admin-quick-card danger">
            <div class="admin-quick-icon">
                <i class="bi bi-people-fill"></i>
            </div>
            <div class="admin-quick-content">
                <h5 class="admin-quick-title">Gerenciar Usuários</h5>
                <p class="admin-quick-desc">Criar, editar e excluir usuários</p>
            </div>
        </a>

        <a href="{{ url_for('admin.dashboard') }}" class="admin-quick-card">
            <div class="admin-quick-icon">
                <i class="bi bi-speedometer2"></i>
            </div>
            <div class="admin-quick-content">
                <h5 class="admin-quick-title">Painel Admin</h5>
                <p class="admin-quick-desc">Produtos, categorias e pedidos</p>
            </div>
        </a>

        <a href="/dashboard" class="admin-quick-card success">
            <div class="admin-quick-icon">
                <i class="bi bi-graph-up-arrow"></i>
            </div>
            <div class="admin-quick-content">
                <h5 class="admin-quick-title">Dashboard BI</h5>
                <p class="admin-quick-desc">Relatórios e métricas</p>
            </div>
        </a>

        <a href="/crm" class="admin-quick-card info">
            <div class="admin-quick-icon">
                <i class="bi bi-person-rolodex"></i>
            </div>
            <div class="admin-quick-content">
                <h5 class="admin-quick-title">CRM</h5>
                <p class="admin-quick-desc">Gestão de clientes</p>
            </div>
        </a>
    </div>

    <!-- More Stats -->
    <div class="row g-4 mb-5">
        <div class="col-lg-4 col-md-6">
            <div class="admin-card">
                <div class="admin-card-body d-flex align-items-center justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Produtos</p>
                        <h3 class="mb-0">{{ total_produtos }}</h3>
                    </div>
                    <i class="bi bi-box-seam text-primary" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="admin-card">
                <div class="admin-card-body d-flex align-items-center justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Pedidos</p>
                        <h3 class="mb-0">{{ total_pedidos }}</h3>
                    </div>
                    <i class="bi bi-bag-check text-success" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="admin-card">
                <div class="admin-card-body d-flex align-items-center justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Categorias</p>
                        <h3 class="mb-0">{{ total_categorias }}</h3>
                    </div>
                    <i class="bi bi-tags text-warning" style="font-size: 2.5rem;"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Users -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h5>
                <i class="bi bi-clock-history me-2"></i>
                Últimos Usuários Cadastrados
            </h5>
            <a href="{{ url_for('super_admin.listar_usuarios') }}" class="btn btn-sm btn-outline-primary">
                Ver Todos
            </a>
        </div>
        <div class="admin-card-body p-0">
            <!-- Desktop Table -->
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Tipo</th>
                            <th>Status</th>
                            <th>Data Cadastro</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usuario in ultimos_usuarios %}
                        <tr>
                            <td><strong>{{ usuario.nome }}</strong></td>
                            <td>{{ usuario.email }}</td>
                            <td>
                                {% if usuario.tipo_usuario == 'super_admin' %}
                                    <span class="badge bg-danger">
                                        <i class="bi bi-shield-lock-fill me-1"></i>Super Admin
                                    </span>
                                {% elif usuario.tipo_usuario == 'admin' %}
                                    <span class="badge bg-warning text-dark">
                                        <i class="bi bi-person-badge-fill me-1"></i>Admin
                                    </span>
                                {% else %}
                                    <span class="badge bg-secondary">
                                        <i class="bi bi-person-fill me-1"></i>Cliente
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                {% if usuario.ativo %}
                                    <span class="badge bg-success">Ativo</span>
                                {% else %}
                                    <span class="badge bg-secondary">Inativo</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if usuario.data_criacao %}
                                    {{ usuario.data_criacao.strftime('%d/%m/%Y %H:%M') }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ url_for('super_admin.editar_usuario', user_id=usuario.id) }}"
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Mobile Cards -->
            <div class="admin-mobile-cards" style="padding: var(--space-4);">
                {% for usuario in ultimos_usuarios %}
                <div class="admin-mobile-card">
                    <div class="admin-mobile-card-header">
                        <div class="admin-mobile-card-title">
                            <i class="bi bi-person-circle text-primary"></i>
                            <span>{{ usuario.nome }}</span>
                        </div>
                        {% if usuario.tipo_usuario == 'super_admin' %}
                            <span class="badge bg-danger">Super Admin</span>
                        {% elif usuario.tipo_usuario == 'admin' %}
                            <span class="badge bg-warning text-dark">Admin</span>
                        {% else %}
                            <span class="badge bg-secondary">Cliente</span>
                        {% endif %}
                    </div>
                    <div class="admin-mobile-card-body">
                        <div class="admin-mobile-row">
                            <span class="admin-mobile-label">Email</span>
                            <span class="admin-mobile-value">{{ usuario.email }}</span>
                        </div>
                        <div class="admin-mobile-row">
                            <span class="admin-mobile-label">Status</span>
                            <span class="admin-mobile-value">
                                {% if usuario.ativo %}
                                    <span class="badge bg-success">Ativo</span>
                                {% else %}
                                    <span class="badge bg-secondary">Inativo</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="admin-mobile-row">
                            <span class="admin-mobile-label">Cadastro</span>
                            <span class="admin-mobile-value">
                                {{ usuario.data_criacao.strftime('%d/%m/%Y') if usuario.data_criacao else '-' }}
                            </span>
                        </div>
                    </div>
                    <div class="admin-mobile-card-footer">
                        <a href="{{ url_for('super_admin.editar_usuario', user_id=usuario.id) }}"
                           class="btn btn-outline-primary w-100">
                            <i class="bi bi-pencil me-2"></i>Editar
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
